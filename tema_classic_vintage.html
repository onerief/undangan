<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="undanganTitle">Loading Undangan...</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Great+Vibes&display=swap" rel="stylesheet">
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* Custom CSS Variables - TEMA CLASSIC NAVY ELEGANCE */
        :root {
            --primary-color: #001F3F; /* Deep Navy Blue */
            --secondary-color: #F8F8F8; /* Near White / Light Silver */
            --accent-color: #C0C0C0; /* Silver */
            --text-color: #333333;
            --font-title: 'Great Vibes', cursive;
            --font-body: 'Playfair Display', serif;
            --bg-body: #ffffff;
            --bg-motif: url('light_pattern.png'); /* ASSET YANG DIBUTUHKAN */
        }
        body { font-family: var(--font-body); color: var(--text-color); background-color: var(--bg-body); scroll-behavior: smooth; padding-bottom: 50px; }
        .hero-section {
            /* Warna Navy Dominan pada Sampul */
            background-color: var(--primary-color);
            background-image: linear-gradient(rgba(0,31,63,0.9), rgba(0,31,63,0.9)), url('hero.jpg'); 
            background-blend-mode: overlay;
            background-size: cover; 
            background-position: center; 
            background-attachment: fixed; /* KUNCI PARALLAX */
            height: 100vh; display: flex; align-items: center; justify-content: center; text-align: center;
            color: var(--secondary-color);
            padding: 2rem;
        }
        .title-font { font-family: 'Great Vibes', cursive; }
        .section-bg { 
            background-color: var(--secondary-color); 
            background-image: var(--bg-motif); 
            background-repeat: repeat;
            padding: 3rem 1.5rem; 
        }
        
        /* Silver Divider Style */
        .section-title { position: relative; display: inline-block; padding-bottom: 25px; }
        .section-title::after {
            content: ''; position: absolute; left: 50%; bottom: 0; transform: translateX(-50%); width: 150px; height: 1px;
            background-color: var(--accent-color); 
            box-shadow: 0 0 5px var(--accent-color); /* Added subtle shadow for elegance */
        }
        
        /* New Divider for Single Column Layout */
        .vertical-divider {
            height: 100px;
            width: 1px;
            background-color: var(--accent-color);
            margin: 20px auto;
        }

        .photo-frame {
            border: 5px solid var(--accent-color);
            box-shadow: 0 0 15px rgba(0, 31, 63, 0.5);
        }
        .photo-circle {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            border: 3px solid var(--primary-color);
            margin: 0 auto 1rem;
            object-fit: cover;
        }

        /* ANIMATION STYLES */
        .fade-in-section {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.8s ease-out, transform 0.8s ease-out;
            will-change: opacity, transform;
        }
        .fade-in-section.is-visible {
            opacity: 1;
            transform: translateY(0);
        }

        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-thumb { background: var(--primary-color); border-radius: 10px; }
        .modal-backdrop { background-color: rgba(0, 31, 63, 0.9); backdrop-filter: blur(5px); }
        .rotating { animation: rotate 2s linear infinite; }
        @keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <!-- 1. MODAL (Pintu Masuk & Salam Personalisasi) -->
    <div id="welcomeModal" class="fixed inset-0 z-50 flex items-center justify-center modal-backdrop transition-opacity duration-500">
        <div class="bg-white p-8 md:p-10 max-w-sm md:max-w-md w-11/12 rounded-xl shadow-2xl text-center fade-in border border-gray-300">
            <h1 class="text-3xl md:text-4xl title-font mb-4" style="color: var(--primary-color);" id="modalNamaPanggilan">Rifki & Aulia</h1>
            <p class="text-xl md:text-2xl text-gray-800 mb-2 font-serif">The Wedding Celebration</p>
            <p class="mt-6 text-gray-600 font-serif">You are cordially invited to:</p>
            <p id="guestNameDisplay" class="text-2xl title-font font-bold mt-2 mb-6" style="color: var(--primary-color);">[Nama Tamu]</p>
            <button id="openInvitationButton" class="w-full text-white font-semibold py-3 px-6 rounded-lg shadow-lg transition duration-300" style="background-color: var(--primary-color);">
                <i class="fas fa-scroll mr-2"></i> Buka Undangan Resmi
            </button>
        </div>
        <audio id="backgroundMusic" loop><source src="music.mp3" type="audio/mpeg"></audio>
    </div>

    <!-- 2. KONTEN UTAMA UNDANGAN -->
    <main id="mainContent" class="hidden">
        
        <!-- Bagian 1: Hero / Sampul Depan (Parallax Enabled via CSS) -->
        <section id="sampul" class="hero-section text-white">
            <div class="max-w-xl mx-auto p-4">
                <p class="text-4xl title-font mb-4" style="color: var(--accent-color);">The Wedding of</p>
                
                <!-- Frame Foto Mempelai -->
                <div class="w-48 h-48 mx-auto my-6 rounded-full overflow-hidden photo-frame" style="background-color: var(--secondary-color);">
                    <img src="hero.jpg" alt="Rifki & Aulia" class="w-full h-full object-cover" id="fotoSampul">
                </div>
                
                <h1 class="text-7xl md:text-9xl title-font font-bold mb-4 tracking-wide" id="sampulNamaPanggilan">R & A</h1>
                <p class="text-2xl font-serif mb-8 tracking-widest" style="color: var(--secondary-color);" id="sampulNamaLengkap">Rifki Alamsyah & Aulia Maharani</p>
                <p class="text-2xl font-serif py-2 px-4 border inline-block" style="border-color: var(--accent-color); color: var(--accent-color);" id="sampulTanggal">Dec 05, 2026</p>
                
                <a href="#lokasi" id="viewDetailsButton" class="mt-8 inline-block px-6 py-3 border rounded-full text-sm hover:bg-white transition duration-300" style="color: var(--primary-color); background-color: var(--secondary-color); border-color: var(--secondary-color);">View Details</a>
            </div>
        </section>

        <!-- Bagian 2: Ayat Pembuka -->
        <section id="pembuka" class="section-bg text-center fade-in-section">
            <div class="max-w-2xl mx-auto">
                <h2 class="text-3xl title-font font-bold mb-8 text-gray-700 section-title mx-auto" style="color: var(--primary-color);">With Love and Gratitude</h2>
                <p class="text-lg italic text-gray-600 leading-relaxed font-serif">
                    "Dan di antara tanda-tanda kekuasaan-Nya ialah Dia menciptakan untukmu pasangan-pasangan dari jenismu sendiri, supaya kamu cenderung dan merasa tenteram kepadanya, dan dijadikan-Nya di antaramu rasa kasih dan sayang. Sungguh, pada yang demikian itu benar-benar terdapat tanda-tanda (kebesaran Allah) bagi kaum yang berpikir."
                </p>
                <p class="mt-4 text-sm font-semibold text-gray-500">(QS. Ar-Rum: 21)</p>
            </div>
        </section>

        <!-- Bagian 3: Detail Mempelai (Kolom Vertikal) -->
        <section id="mempelai" class="section-bg fade-in-section text-center" style="background-color: var(--bg-body);">
            <h2 class="text-3xl title-font font-bold text-center mb-10 section-title mx-auto" style="color: var(--primary-color);">The Bride & Groom</h2>
            
            <div class="max-w-xs mx-auto text-center">
                <!-- Foto Rifki -->
                <img src="profil-arif.jpg" alt="Foto Rifki" class="photo-circle border-4" style="border-color: var(--primary-color);" id="fotoPria">
                <p class="text-4xl title-font font-bold mb-2" style="color: var(--primary-color);" id="priaPanggilanTxt">Rifki</p>
                <p class="text-base font-semibold text-gray-800 font-serif mb-1" id="priaLengkapTxt">(Rifki Alamsyah)</p>
                <p class="text-gray-600 font-serif" id="priaOrtuTxt">Son of Mr. Haryanto & Mrs. Lestari</p>
                <div class="mt-3"><a href="#" target="_blank" class="text-gray-500 hover:text-blue-800 mx-2 text-xl"><i class="fab fa-instagram"></i></a></div>
            </div>
            
            <!-- Ornamen Penghubung -->
            <div class="text-center my-6">
                <p class="text-4xl title-font font-bold" style="color: var(--accent-color);">&</p>
            </div>
            
            <div class="max-w-xs mx-auto text-center">
                <!-- Foto Aulia -->
                <img src="profil-vuah.jpg" alt="Foto Aulia" class="photo-circle border-4" style="border-color: var(--primary-color);" id="fotoWanita">
                <p class="text-4xl title-font font-bold mb-2" style="color: var(--primary-color);" id="wanitaPanggilanTxt">Aulia</p>
                <p class="text-base font-semibold text-gray-800 font-serif mb-1" id="wanitaLengkapTxt">(Aulia Maharani)</p>
                <p class="text-gray-600 font-serif" id="wanitaOrtuTxt">Daughter of Mr. Sudirman & Mrs. Nurhayati</p>
                <div class="mt-3"><a href="#" target="_blank" class="text-gray-500 hover:text-blue-800 mx-2 text-xl"><i class="fab fa-instagram"></i></a></div>
            </div>
        </section>

        <!-- Bagian 4: Detail Acara & Countdown (Layout Vertikal Baru) -->
        <section id="lokasi" class="section-bg text-center fade-in-section">
            <h2 class="text-3xl title-font font-bold mb-8 section-title mx-auto" style="color: var(--primary-color);">Schedule</h2>
            <p class="text-gray-600 mb-8 font-serif">We look forward to celebrating with you at:</p>

            <!-- Countdown Timer -->
            <div id="countdown" class="max-w-xs mx-auto mb-10 p-6 rounded-xl shadow-inner border border-gray-300" style="background-color: var(--secondary-color);">
                <p class="text-lg font-semibold mb-4 text-gray-700 font-serif">Countdown:</p>
                <div class="flex justify-center space-x-3 text-center text-gray-800">
                    <div class="w-16 p-2 bg-white rounded-lg shadow-md"><p id="days" class="text-3xl font-extrabold" style="color: var(--primary-color);"></p><span class="text-xs mt-1 block font-serif">DAYS</span></div>
                    <div class="w-16 p-2 bg-white rounded-lg shadow-md"><p id="hours" class="text-3xl font-extrabold" style="color: var(--primary-color);"></p><span class="text-xs mt-1 block font-serif">HRS</span></div>
                    <div class="w-16 p-2 bg-white rounded-lg shadow-md"><p id="minutes" class="text-3xl font-extrabold" style="color: var(--primary-color);"></p><span class="text-xs mt-1 block font-serif">MINS</span></div>
                    <div class="w-16 p-2 bg-white rounded-lg shadow-md"><p id="seconds" class="text-3xl font-extrabold" style="color: var(--primary-color);"></p><span class="text-xs mt-1 block font-serif">SECS</span></div>
                </div>
            </div>

            <div class="max-w-md mx-auto">
                <!-- Detail Acara 1: Ceremony -->
                <div class="p-6 rounded-xl shadow-xl text-gray-800 border-t-4 text-center" style="background-color: var(--secondary-color); border-color: var(--accent-color);">
                    <i class="fas fa-church text-4xl mb-4" style="color: var(--primary-color);"></i>
                    <h3 class="text-2xl font-serif font-semibold mb-2" style="color: var(--primary-color);">The Ceremony</h3>
                    <p class="font-medium font-serif" id="akadTanggalTxt">Saturday, 05 December 2026</p>
                    <p class="text-lg font-bold mb-4 font-serif" id="akadWaktuTxt">09.00 AM - 10.30 AM</p>
                    <p class="text-sm font-serif" id="alamatAcaraTxt">Gedung Serbaguna Puri Kencana, Kota Jakarta</p>
                </div>

                <!-- Vertical Divider / Pemisah Elegan -->
                <div class="vertical-divider my-6"></div>

                <!-- Detail Acara 2: Reception -->
                <div class="p-6 rounded-xl shadow-xl text-gray-800 border-b-4 text-center" style="background-color: var(--secondary-color); border-color: var(--accent-color);">
                    <i class="fas fa-champagne-glasses text-4xl mb-4" style="color: var(--primary-color);"></i>
                    <h3 class="text-2xl font-serif font-semibold mb-2" style="color: var(--primary-color);">The Reception</h3>
                    <p class="font-medium font-serif" id="resepsiTanggalTxt">Saturday, 05 December 2026</p>
                    <p class="text-lg font-bold mb-4 font-serif" id="resepsiWaktuTxt">11.00 AM - Selesai</p>
                    <p class="text-sm font-serif" id="alamatAcaraTxt2">Gedung Serbaguna Puri Kencana, Kota Jakarta</p>
                </div>
            </div>


            <!-- Google Maps -->
            <div class="mt-10 max-w-4xl mx-auto">
                <div class="rounded-xl overflow-hidden shadow-xl border-2" style="border-color: var(--primary-color);">
                    <iframe id="mapsEmbed" src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3966.568407425126!2d106.8209355!3d-6.1873117!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x2e69f52f357f88e1%3A0x67a0a6184001e30!2sGedung%20Serbaguna%20Pusdiklat%20Kemnaker!5e0!3m2!1sen!2sid!4v1700000000000!5m2!1sen!2sid" width="100%" height="450" style="border:0;" allowfullscreen="" loading="lazy"></iframe>
                </div>
                <a id="mapsLink" href="https://maps.app.goo.gl/example" target="_blank" class="mt-4 inline-flex items-center px-4 py-2 text-white rounded-full hover:bg-opacity-90 transition duration-300 shadow-md font-serif" style="background-color: var(--primary-color);">
                    <i class="fas fa-map-marker-alt mr-2"></i> Open in Maps
                </a>
            </div>
        </section>

        <!-- Bagian 5: Galeri Foto -->
        <section id="galeri" class="section-bg text-center fade-in-section" style="background-color: var(--bg-body);">
            <h2 class="text-3xl title-font font-bold text-center mb-10 section-title mx-auto" style="color: var(--primary-color);">Photo Album</h2>
            <div class="max-w-4xl mx-auto grid grid-cols-2 md:grid-cols-3 gap-4 text-center">
                <div class="aspect-square overflow-hidden rounded-lg shadow-lg hover:scale-[1.03] transition duration-300 cursor-pointer photo-frame border-none mx-auto"><img src="galeri-1.jpg" class="w-full h-full object-cover" alt="Gallery Photo 1"></div>
                <div class="aspect-square overflow-hidden rounded-lg shadow-lg hover:scale-[1.03] transition duration-300 cursor-pointer photo-frame border-none mx-auto"><img src="galeri-2.jpg" class="w-full h-full object-cover" alt="Gallery Photo 2"></div>
                <div class="aspect-square overflow-hidden rounded-lg shadow-lg hover:scale-[1.03] transition duration-300 cursor-pointer photo-frame border-none mx-auto"><img src="galeri-3.jpg" class="w-full h-full object-cover" alt="Gallery Photo 3"></div>
                <div class="aspect-square overflow-hidden rounded-lg shadow-lg hover:scale-[1.03] transition duration-300 cursor-pointer photo-frame border-none mx-auto"><img src="galeri-4.jpg" class="w-full h-full object-cover" alt="Gallery Photo 4"></div>
                <div class="aspect-square overflow-hidden rounded-lg shadow-lg hover:scale-[1.03] transition duration-300 cursor-pointer photo-frame border-none mx-auto"><img src="galeri-5.jpg" class="w-full h-full object-cover" alt="Gallery Photo 5"></div>
                <div class="aspect-square overflow-hidden rounded-lg shadow-lg hover:scale-[1.03] transition duration-300 cursor-pointer photo-frame border-none mx-auto"><img src="galeri-6.jpg" class="w-full h-full object-cover" alt="Gallery Photo 6"></div>
            </div>
        </section>

        <!-- Bagian 6: Amplop Digital / Hadiah -->
        <section id="hadiah" class="section-bg text-center fade-in-section" style="background-color: var(--bg-body);">
            <h2 class="text-3xl title-font font-bold mb-8 section-title mx-auto" style="color: var(--primary-color);">Gift Registry</h2>
            <p class="text-gray-600 mb-8 max-w-2xl mx-auto font-serif">Your presence is our most cherished gift. However, if you wish to give a gift, here are the options:</p>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 max-w-4xl mx-auto">
                <div class="p-6 rounded-xl shadow-xl border-2 text-center" style="background-color: var(--secondary-color); border-color: var(--primary-color);">
                    <h3 class="text-2xl font-serif font-bold mb-4" style="color: var(--primary-color);" id="digitalGiftHeader1"><i class="fas fa-wallet mr-2"></i> Digital Gift (Pria)</h3>
                    <div class="mb-4 p-3 rounded-lg border-b border-gray-300 text-center" style="background-color: #ffffff;">
                        <p class="text-sm font-semibold text-gray-700 font-serif" id="rekName1">Bank Mandiri (A.n. Rifki Alamsyah)</p>
                        <p id="rekeningArifJago" class="text-xl font-bold mt-1 text-gray-800 font-serif">1234567890123</p>
                        <button onclick="copyToClipboard('rekeningArifJago', this)" class="text-sm hover:underline mt-1 focus:outline-none" style="color: var(--primary-color);"><i class="fas fa-copy"></i> Copy Number</button>
                    </div>
                    <div class="p-3 rounded-lg text-center" style="background-color: #ffffff;">
                        <p class="text-sm font-semibold text-gray-700 font-serif" id="rekName2">Bank BCA (A.n. Aulia Maharani)</p>
                        <p id="rekeningVuahSeaBank" class="text-xl font-bold mt-1 text-gray-800 font-serif">9876543210987</p>
                        <button onclick="copyToClipboard('rekeningVuahSeaBank', this)" class="text-sm hover:underline mt-1 focus:outline-none" style="color: var(--primary-color);"><i class="fas fa-copy"></i> Copy Number</button>
                    </div>
                </div>

                <div class="p-6 rounded-xl shadow-xl border-2 text-center" style="background-color: var(--secondary-color); border-color: var(--primary-color);">
                    <h3 class="text-2xl font-serif font-bold mb-4" style="color: var(--primary-color);"><i class="fas fa-box-open mr-2"></i> Physical Gift</h3>
                    <div class="p-3 rounded-lg text-center" style="background-color: #ffffff;">
                        <p class="text-sm font-semibold text-gray-700 font-serif">Shipping Address:</p>
                        <p id="alamatKado" class="mt-2 text-base text-gray-800 font-medium font-serif">
                            Jl. Raya Contoh No. 45, Kel. Kebayoran, Kec. Setiabudi, Kota Jakarta Selatan, DKI Jakarta, 12910.
                        </p>
                        <p class="text-sm text-gray-600 mt-2 font-serif">Recipient: Rifki or Aulia</p>
                        <button onclick="copyToClipboard('alamatKado', this)" class="text-sm hover:underline mt-4 focus:outline-none" style="color: var(--primary-color);"><i class="fas fa-copy"></i> Copy Full Address</button>
                    </div>
                </div>
            </div>
            <div id="messageBox" class="fixed bottom-20 left-1/2 transform -translate-x-1/2 bg-green-600 text-white p-3 rounded-lg shadow-lg hidden transition-opacity duration-300 z-50"></div>
        </section>

        <!-- Bagian 7: RSVP & Ucapan/Doa (Buku Tamu Digital) -->
        <section id="guestbook" class="section-bg text-center fade-in-section">
            <h2 class="text-3xl title-font font-bold text-center mb-10 section-title mx-auto" style="color: var(--primary-color);">R.S.V.P & Guestbook</h2>
            <div class="max-w-xl mx-auto p-6 rounded-xl shadow-xl bg-white mb-10 border border-gray-300">
                <form id="rsvpForm">
                    <div class="mb-4">
                        <label for="guestNameInput" class="block text-sm font-medium text-gray-700 mb-2 font-serif">Your Name:</label>
                        <input type="text" id="guestNameInput" name="guestName" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-primary-color focus:border-primary-color bg-gray-50 font-serif">
                    </div>
                    <div class="mb-4">
                        <label for="attendance" class="block text-sm font-medium text-gray-700 mb-2 font-serif">Attendance:</label>
                        <select id="attendance" name="attendance" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-primary-color focus:border-primary-color bg-gray-50 font-serif">
                            <option value="">-- Select Status --</option>
                            <option value="Hadir">Attending</option>
                            <option value="Tidak Hadir">Unable to Attend</option>
                        </select>
                    </div>
                    <div class="mb-6">
                        <label for="message" class="block text-sm font-medium text-gray-700 mb-2 font-serif">Wishes & Message:</label>
                        <textarea id="message" name="message" rows="4" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-primary-color focus:border-primary-color bg-gray-50 font-serif" placeholder="Write your wishes..."></textarea>
                    </div>
                    <button type="submit" id="submitButton" class="w-full text-white font-semibold py-3 px-6 rounded-lg shadow-md transition duration-300 font-serif" style="background-color: var(--primary-color);">
                        Submit Confirmation & Message
                    </button>
                </form>
                <p id="formStatus" class="mt-4 text-center text-sm font-medium font-serif"></p>
            </div>
            <div class="max-w-2xl mx-auto mt-10">
                <h3 class="text-2xl font-serif font-semibold mb-6 text-center text-gray-700">Best Wishes from Guests</h3>
                <div id="wishesList" class="space-y-4">
                    <p class="text-center text-gray-500 font-serif" id="loadingWishes">Loading wishes...</p>
                </div>
            </div>
        </section>

        <!-- Bagian 8: Penutup -->
        <section id="penutup" class="section-bg text-center" style="background-color: var(--secondary-color);">
            <div class="max-w-2xl mx-auto">
                <p class="text-lg italic text-gray-700 mb-6 font-serif">Thank you for visiting our page. We hope to see you there!</p>
                <h3 class="text-4xl title-font font-bold" style="color: var(--primary-color);" id="penutupNama">Rifki & Aulia</h3>
                <p class="text-sm mt-6 text-gray-500 font-serif">© 2026 Classic Navy Elegance Template</p>
            </div>
        </section>
        
    </main>
    
    <!-- Music Control Button -->
    <button id="musicButton" class="bg-white p-3 rounded-full shadow-xl hidden fixed bottom-4 right-4 z-40">
        <i id="musicIcon" class="fas fa-music text-xl rotating" style="color: var(--primary-color);"></i>
    </button>
    
    <!-- Scroll to Top Button (BARU) -->
    <button id="scrollToTopBtn" class="bg-white p-3 rounded-full shadow-xl fixed bottom-4 right-20 z-40 hidden hover:scale-105 transition duration-300" style="color: var(--primary-color); border: 1px solid var(--primary-color);">
        <i class="fas fa-arrow-up text-xl"></i>
    </button>

    <!-- 3. JAVASCRIPT & FIREBASE LOGIC -->
    <script type="module">
        // Firebase Imports
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, onSnapshot, query, setDoc, doc, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        setLogLevel('Debug');

        // --- KONFIGURASI FIREBASE BARU ---
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'bisnisundangan-69025'; 
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {
            apiKey: "AIzaSyB2CHJqYrwSVVwJsEc1Cosw3GKFRF6m8Fc",
            authDomain: "bisnisundangan-69025.firebaseapp.com",
            projectId: "bisnisundangan-69025",
            storageBucket: "bisnisundangan-69025.firebasestorage.app",
            messagingSenderId: "1061283170101",
            appId: "1:1061283170101:web:bde0c4990a3fc14b5bae7c"
        };
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        // --- PATH DATA UNTUK CLIENT (PRIVATE) ---
        const INVITATION_DATA_PATH = 'invitation_data'; 
        const INVITATION_DOC_ID = 'current';

        // TEMPLATE Logic - FireStore Collection Name is dynamic for this business
        let PUBLIC_COLLECTION_NAME = 'wedding_wishes_navy_default'; // Default name

        
        let app, db, auth, userId;
        let customerId = null; // ID Pelanggan yang datanya akan diambil
        
        function getQueryParam(param) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param);
        }
        
        customerId = getQueryParam('user'); 

        async function initializeFirebase() {
            try {
                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                
                if (initialAuthToken) { await signInWithCustomToken(auth, initialAuthToken); } else { await signInAnonymously(auth); }
                
                userId = auth.currentUser?.uid || crypto.randomUUID();

                await loadInvitationData(customerId);
                // setupWishesListener is called after loadInvitationData updates PUBLIC_COLLECTION_NAME
                
            } catch (error) {
                console.error("Error initializing Firebase:", error);
                document.getElementById('formStatus').textContent = "Terjadi kesalahan saat menghubungkan ke database.";
            }
        }
        
        async function loadInvitationData(id) {
            if (!id) {
                console.log("Tidak ada User ID, menggunakan data default.");
                // Jika tidak ada user ID, gunakan data hardcode yang sudah ada (current static values)
                setupWishesListener();
                return; 
            }
            
            try {
                // Path: artifacts/{appId}/users/{customerId}/invitation_data/current
                const customerDocRef = doc(db, `artifacts/${appId}/users/${id}/${INVITATION_DATA_PATH}`, INVITATION_DOC_ID);
                const docSnap = await getDoc(customerDocRef);

                if (docSnap.exists()) {
                    const data = docSnap.data();
                    renderInvitation(data);
                    // Update public collection name based on customer ID
                    PUBLIC_COLLECTION_NAME = `wedding_wishes_${id}`;
                } else {
                    console.error("Data undangan tidak ditemukan untuk user ID ini. Menggunakan data default.");
                }
                setupWishesListener(); // Panggil setelah koleksi diperbarui
            } catch (error) {
                console.error("Error fetching private data:", error);
                setupWishesListener();
            }
        }

        function renderInvitation(data) {
            // Helper untuk memformat tanggal (contoh: Dec 05, 2026)
            const dateFormatter = (isoDate) => {
                if (!isoDate) return 'Dec 05, 2026';
                const dateObj = new Date(isoDate);
                const options = { year: 'numeric', month: 'short', day: 'numeric', timeZone: 'Asia/Jakarta' };
                return dateObj.toLocaleDateString('en-US', options);
            };

            // Helper untuk memformat waktu saja (contoh: 09:00 AM)
            const formatTimeOnly = (isoDate) => {
                if (!isoDate) return '09:00 AM';
                const dateObj = new Date(isoDate);
                return dateObj.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: true, timeZone: 'Asia/Jakarta' });
            };

            // 1. Update Judul & Sampul
            const namaPanggilan = `${data.wanitaPanggilan} & ${data.priaPanggilan}`;
            document.getElementById('undanganTitle').textContent = `The Wedding of ${namaPanggilan}`;
            document.getElementById('modalNamaPanggilan').textContent = namaPanggilan;
            document.getElementById('sampulNamaPanggilan').textContent = `${data.wanitaPanggilan.substring(0, 1)} & ${data.priaPanggilan.substring(0, 1)}`;
            document.getElementById('sampulNamaLengkap').textContent = `${data.wanitaLengkap} & ${data.priaLengkap}`;
            
            document.getElementById('penutupNama').textContent = namaPanggilan;
            
            // 2. Update Mempelai
            document.getElementById('priaPanggilanTxt').textContent = data.priaPanggilan;
            document.getElementById('priaLengkapTxt').textContent = `(${data.priaLengkap})`;
            document.getElementById('priaOrtuTxt').textContent = data.priaOrtu;
            
            document.getElementById('wanitaPanggilanTxt').textContent = data.wanitaPanggilan;
            document.getElementById('wanitaLengkapTxt').textContent = `(${data.wanitaLengkap})`;
            document.getElementById('wanitaOrtuTxt').textContent = data.wanitaOrtu;

            // 3. Update Acara & Countdown
            const tglAkadObj = new Date(data.tglAkad);
            const tglResepsiObj = new Date(data.tglResepsi);
            
            document.getElementById('sampulTanggal').textContent = dateFormatter(tglAkadObj);
            window.targetDate = tglAkadObj.getTime(); // Set Countdown
            
            document.getElementById('akadTanggalTxt').textContent = dateFormatter(tglAkadObj);
            document.getElementById('akadWaktuTxt').textContent = formatTimeOnly(data.tglAkad) + ' - 10.30 AM'; // Defaulting to 10.30 AM end time
            document.getElementById('alamatAcaraTxt').textContent = data.alamatAcara;
            
            document.getElementById('resepsiTanggalTxt').textContent = dateFormatter(tglResepsiObj);
            document.getElementById('resepsiWaktuTxt').textContent = formatTimeOnly(data.tglResepsi) + ' - Selesai'; // Assuming Resepsi is "til finish"
            document.getElementById('alamatAcaraTxt2').textContent = data.alamatAcara;

            // 4. Update Maps
            if (data.linkMaps) {
                document.getElementById('mapsEmbed').src = data.linkMaps.replace('maps.app.goo.gl', 'www.google.com/maps/embed'); 
                document.getElementById('mapsLink').href = data.linkMaps;
            }

            // 5. Update Hadiah
            const getBankName = (input) => input.split(' ')[0] || 'Digital';
            const getAccountNumber = (input) => input.split(' ')[1] || '0000000000000';

            // Rekening Pria
            document.getElementById('digitalGiftHeader1').innerHTML = `<i class="fas fa-wallet mr-2"></i> Digital Gift (${data.priaPanggilan})`;
            document.getElementById('rekName1').textContent = `${getBankName(data.rekArif)} (A.n. ${data.priaLengkap.split(' ')[0]})`;
            document.getElementById('rekeningArifJago').textContent = getAccountNumber(data.rekArif);
            
            // Rekening Wanita
            document.getElementById('rekName2').textContent = `${getBankName(data.rekVuah)} (A.n. ${data.wanitaLengkap.split(' ')[0]})`;
            document.getElementById('rekeningVuahSeaBank').textContent = getAccountNumber(data.rekVuah);
            
            document.getElementById('alamatKado').textContent = data.alamatKado;
            
        }

        // Core Logic (Same as other templates)
        function getGuestName() {
            const urlParams = new URLSearchParams(window.location.search);
            let name = urlParams.get('to') || 'Guest';
            return name.replace(/</g, "&lt;").replace(/>/g, "&gt;"); 
        }

        const guestName = getGuestName();
        document.getElementById('guestNameDisplay').textContent = guestName;
        document.getElementById('guestNameInput').value = guestName; 

        const welcomeModal = document.getElementById('welcomeModal');
        const mainContent = document.getElementById('mainContent');
        const openButton = document.getElementById('openInvitationButton');
        const musicButton = document.getElementById('musicButton');
        const musicIcon = document.getElementById('musicIcon');
        const audio = document.getElementById('backgroundMusic');
        let isPlaying = false;

        function toggleMusic() { 
            if (isPlaying) { audio.pause(); musicIcon.classList.remove('rotating'); isPlaying = false; } 
            else { audio.play().catch(error => { console.error("Autoplay prevented:", error); }); musicIcon.classList.add('rotating'); isPlaying = true; }
        }

        openButton.addEventListener('click', () => { 
            welcomeModal.style.opacity = '0'; welcomeModal.style.transform = 'translateY(-20px)';
            setTimeout(() => {
                welcomeModal.classList.add('hidden'); mainContent.classList.remove('hidden');
                musicButton.classList.remove('hidden'); toggleMusic(); 
                document.getElementById('sampul').scrollIntoView({ behavior: 'smooth' });
            }, 500);
        });

        musicButton.addEventListener('click', toggleMusic);

        // NOTE: TARGET DATE DIBERIKAN HARGA DEFAULT UNTUK TESTING, AKAN DITIMPA OLEH FIREBASE
        const initialTargetDate = new Date(); 
        initialTargetDate.setFullYear(initialTargetDate.getFullYear() + 1); // Set 1 year ahead
        window.targetDate = initialTargetDate.getTime(); 

        function updateCountdown() { 
            const now = new Date().getTime(); const distance = window.targetDate - now;
            if (distance < 0) {
                document.getElementById("countdown").innerHTML = "<p class='text-2xl font-bold' style='color: var(--primary-color);'>EVENT IS LIVE!</p>";
                clearInterval(countdownInterval); return;
            }
            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distance % (1000 * 60)) / 1000);

            document.getElementById("days").textContent = String(days).padStart(2, '0');
            document.getElementById("hours").textContent = String(hours).padStart(2, '0');
            document.getElementById("minutes").textContent = String(minutes).padStart(2, '0');
            document.getElementById("seconds").textContent = String(seconds).padStart(2, '0');
        }

        const countdownInterval = setInterval(updateCountdown, 1000);
        updateCountdown(); 

        window.copyToClipboard = function(elementId, button) { 
            const element = document.getElementById(elementId);
            const textToCopy = element.textContent.trim(); 
            
            const tempInput = document.createElement("textarea"); tempInput.value = textToCopy;
            document.body.appendChild(tempInput); tempInput.select(); document.execCommand('copy');
            document.body.removeChild(tempInput);
            
            const isAddress = elementId === 'alamatKado';
            const messageText = isAddress ? "Address copied!" : "Number copied!";
            showMessageBox(messageText, 2000);
            
            const originalText = button.innerHTML;
            button.innerHTML = '<i class="fas fa-check"></i> Copied!';
            setTimeout(() => { button.innerHTML = originalText; }, 1000);
        }

        function showMessageBox(message, duration = 3000) { 
            const box = document.getElementById('messageBox');
            box.textContent = message; box.classList.remove('hidden', 'opacity-0');
            box.classList.add('opacity-100');
            
            setTimeout(() => {
                box.classList.remove('opacity-100'); box.classList.add('opacity-0');
                setTimeout(() => box.classList.add('hidden'), 300); 
            }, duration);
        }
        
        const rsvpForm = document.getElementById('rsvpForm');
        const submitButton = document.getElementById('submitButton');
        const formStatus = document.getElementById('formStatus');

        rsvpForm.addEventListener('submit', async (e) => { 
            e.preventDefault();
            if (!db) { formStatus.textContent = "Database not ready. Try again."; formStatus.className = 'mt-4 text-center text-sm font-medium text-red-600'; return; }

            const name = document.getElementById('guestNameInput').value.trim();
            const attendance = document.getElementById('attendance').value;
            const message = document.getElementById('message').value.trim();
            
            if (!name || !attendance || !message) { formStatus.textContent = "Please fill all fields."; formStatus.className = 'mt-4 text-center text-sm font-medium text-red-600'; return; }

            submitButton.disabled = true; submitButton.textContent = 'Submitting...'; formStatus.textContent = '';

            try {
                const docRefId = name.replace(/\s+/g, '_').toLowerCase();
                // Menggunakan PUBLIC_COLLECTION_NAME yang dinamis
                const docPath = doc(db, `artifacts/${appId}/public/data/${PUBLIC_COLLECTION_NAME}`, docRefId); 

                await setDoc(docPath, { name: name, attendance: attendance, message: message, timestamp: new Date().toISOString(), senderId: userId });

                formStatus.textContent = "Confirmation and message successfully sent! Thank you.";
                formStatus.className = 'mt-4 text-center text-sm font-medium text-green-600';
                rsvpForm.reset();
                document.getElementById('guestNameInput').value = name; 
            } catch (error) {
                console.error("Error submitting document: ", error);
                formStatus.textContent = `Failed to submit. Error: ${error.message}`;
                formStatus.className = 'mt-4 text-center text-sm font-medium text-red-600';
            } finally {
                submitButton.disabled = false; submitButton.textContent = 'Submit Confirmation & Message';
            }
        });

        const wishesList = document.getElementById('wishesList');

        function setupWishesListener() {
            // Cek apakah koleksi sudah diperbarui oleh loadInvitationData
            const collectionName = customerId ? PUBLIC_COLLECTION_NAME : 'wedding_wishes_classic_navy'; 
            const q = query(collection(db, `artifacts/${appId}/public/data/${collectionName}`));

            onSnapshot(q, (snapshot) => {
                const wishes = [];
                snapshot.forEach((doc) => { wishes.push(doc.data()); });
                wishes.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                renderWishes(wishes);
            }, (error) => {
                console.error("Error fetching wishes:", error);
                document.getElementById('loadingWishes').textContent = "Failed to load wishes.";
            });
        }

        function renderWishes(wishes) { 
            wishesList.innerHTML = ''; document.getElementById('loadingWishes')?.remove();

            if (wishes.length === 0) {
                wishesList.innerHTML = '<p class="text-center text-gray-500">No wishes yet. Be the first!</p>'; return;
            }

            wishes.forEach(wish => {
                const date = new Date(wish.timestamp);
                const formattedDate = date.toLocaleDateString('en-US', { day: 'numeric', month: 'short', year: 'numeric' });
                const attendanceIcon = wish.attendance === 'Hadir' 
                    ? '<i class="fas fa-check-circle text-green-500 mr-2"></i> Attending' 
                    : '<i class="fas fa-times-circle text-red-500 mr-2"></i> Not Attending';

                const wishElement = `
                    <div class="p-4 bg-white rounded-xl shadow-lg border-l-4" style="border-color: var(--primary-color);">
                        <div class="flex justify-between items-start mb-2">
                            <p class="font-bold text-lg text-gray-800">${wish.name}</p>
                            <span class="text-xs text-gray-400 font-serif">${formattedDate}</span>
                        </div>
                        <p class="text-gray-700 italic mb-3 font-serif">"${wish.message}"</p>
                        <span class="text-sm font-medium text-gray-600 font-serif">${attendanceIcon}</span>
                    </div>
                `;
                wishesList.innerHTML += wishElement;
            });
        }
        
        // --- Interactivity Logic ---

        // Function to handle scroll animations
        const fadeSections = document.querySelectorAll('.fade-in-section');

        function checkVisibility() { 
            const windowHeight = window.innerHeight;
            fadeSections.forEach(section => {
                const rect = section.getBoundingClientRect();
                if (rect.top < windowHeight * 0.85) { // Appear when 85% of section is visible
                    section.classList.add('is-visible');
                }
            });
        }
        
        // Scroll to Top Logic
        const scrollToTopBtn = document.getElementById('scrollToTopBtn');
        
        window.onscroll = function() { 
            checkVisibility(); 

            // Show/hide scroll to top button
            if (document.body.scrollTop > 500 || document.documentElement.scrollTop > 500) {
                scrollToTopBtn.classList.remove('hidden');
            } else {
                scrollToTopBtn.classList.add('hidden');
            }
        };

        scrollToTopBtn.addEventListener('click', () => {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        });

        // START APP
        window.addEventListener('load', () => {
            initializeFirebase();
            checkVisibility(); 
        });
    </script>
</body>
</html>
